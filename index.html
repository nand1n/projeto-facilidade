<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Projeto Facilidade ‚Ä¢ Login + Upload</title>
  <style>
    :root { --b:#0a84ff; --g:#10b981; --t:#111827; --m:#6b7280; }
    *{box-sizing:border-box} body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f7fafc;color:#111}
    .wrap{max-width:900px;margin:32px auto;padding:0 16px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 4px 18px rgba(0,0,0,.06);padding:18px 18px 20px}
    h1{margin:0 0 8px;font-size:22px} h2{margin:0 0 12px;font-size:18px;color:#111}
    label{display:block;margin:10px 0 6px;color:#111} input[type=text],input[type=password]{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:10px}
    button{padding:10px 14px;border:0;border-radius:10px;background:var(--b);color:#fff;cursor:pointer} button:disabled{opacity:.6;cursor:not-allowed}
    .row{display:flex;gap:12px;flex-wrap:wrap} .row>div{flex:1 1 260px}
    .muted{color:#6b7280;font-size:12px}
    .ok{color:var(--g)} .err{color:#dc2626}
    .hidden{display:none}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#eef2ff;color:#3730a3;font-size:12px}
    .list{margin:10px 0 0;padding-left:18px}
    .sep{height:1px;background:#e5e7eb;margin:14px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- LOGIN -->
    <div id="loginCard" class="card">
      <h1>Entrar</h1>
      <p class="muted">Seu template original permanece. Ajuste apenas a valida√ß√£o abaixo.</p>
      <div class="row">
        <div>
          <label>Usu√°rio</label>
          <input id="user" type="text" autocomplete="username" />
        </div>
        <div>
          <label>Senha</label>
          <input id="pass" type="password" autocomplete="current-password" />
        </div>
      </div>
      <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
        <button id="btnLogin">Entrar</button>
        <span id="loginMsg" class="muted"></span>
      </div>
    </div>

    <div class="sep"></div>

    <!-- √ÅREA AP√ìS LOGIN -->
    <div id="appCard" class="card hidden">
      <div style="display:flex;align-items:center;gap:8px;justify-content:space-between">
        <h2>Bem-vindo! <span class="pill">Sess√£o ativa</span></h2>
        <button id="btnSair" style="background:#374151">Sair</button>
      </div>

      <p class="muted">Aqui fica o restante do seu sistema. Abaixo est√° o m√≥dulo de <strong>upload</strong> (mundo real) que usa <em>/api/upload</em>.</p>

      <!-- M√ìDULO DE UPLOAD (mostra s√≥ ap√≥s login) -->
      <div class="sep"></div>
      <h2>Enviar fotos/documentos</h2>
      <p class="muted">No celular, este bot√£o abre a c√¢mera (ou a galeria). Voc√™ pode selecionar v√°rias fotos.</p>

      <input id="fileInput" type="file" accept="image/*" capture="environment" multiple />
      <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
        <button id="btnEnviar">Enviar</button>
        <span id="upStatus" class="muted"></span>
      </div>
      <ul id="upList" class="list"></ul>
    </div>
  </div>

  <script>
    // ====== PERSIST√äNCIA SIMPLES DE SESS√ÉO (localStorage) ======
    const LS_KEY = "facilidade.auth";
    const $ = (id)=>document.getElementById(id);

    function showApp() {
      $("loginCard").classList.add("hidden");
      $("appCard").classList.remove("hidden");
    }
    function showLogin() {
      $("appCard").classList.add("hidden");
      $("loginCard").classList.remove("hidden");
    }

    // Restaura sess√£o
    (function init(){
      try {
        const ok = JSON.parse(localStorage.getItem(LS_KEY) || "false");
        ok ? showApp() : showLogin();
      } catch { showLogin(); }
    })();

    // ====== LOGIN (AQUI VOC√ä PODE TROCAR A REGRA) ======
    $("btnLogin").onclick = () => {
      const u = $("user").value.trim();
      const p = $("pass").value.trim();

      // üîí TROQUE ESTA REGRA PELO SEU VALIDADOR REAL, SE TIVER.
      // Para teste: aceita qualquer coisa n√£o vazia
      if (u && p) {
        localStorage.setItem(LS_KEY, "true");
        $("loginMsg").textContent = "";
        showApp();
      } else {
        $("loginMsg").textContent = "Preencha usu√°rio e senha.";
        $("loginMsg").className = "muted err";
      }
    };

    $("btnSair").onclick = () => {
      localStorage.removeItem(LS_KEY);
      showLogin();
    };

    // ====== UPLOAD REAL PARA /api/upload (Vercel Blob) ======
    $("btnEnviar").onclick = async () => {
      const input = $("fileInput");
      const files = Array.from(input.files || []);
      const status = $("upStatus");
      const list = $("upList");

      if (!files.length) { alert("Escolha pelo menos um arquivo."); return; }

      status.textContent = "Enviando...";
      list.innerHTML = "";

      try {
        for (const f of files) {
          const res = await fetch("/api/upload", {
            method: "POST",
            headers: {
              "content-type": f.type || "application/octet-stream",
              "x-filename": encodeURIComponent(f.name)
            },
            body: await f.arrayBuffer()
          });

          if (!res.ok) throw new Error(await res.text());
          const data = await res.json();

          const li = document.createElement("li");
          li.innerHTML = `‚úîÔ∏è ${f.name}: <a href="${data.url}" target="_blank">${data.url}</a>`;
          list.appendChild(li);
        }
        status.textContent = "Tudo enviado com sucesso!";
        input.value = "";
      } catch (e) {
        status.textContent = "Erro: " + e.message;
      }
    };
  </script>
</body>
</html>
